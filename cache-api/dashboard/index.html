<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache API - Auth Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üîê API Authentication Dashboard</h1>
                <p>Manage and monitor API authentication tokens</p>
            </div>
            <button type="button" id="logoutBtn" class="btn-logout" style="display: none;">üö™ Logout</button>
        </header>

        <!-- Login Modal -->
        <div id="loginModal" class="modal active">
            <div class="modal-content">
                <div class="login-form">
                    <h2>üîí Login to Dashboard</h2>
                    <div id="loginError" class="alert alert-error" style="display: none;"></div>
                    
                    <div class="form-group">
                        <label for="adminPassword">Admin Password</label>
                        <input 
                            type="password" 
                            id="adminPassword" 
                            placeholder="Enter admin password"
                            autocomplete="off"
                        />
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="handleLogin()" style="width: 100%; justify-content: center;">
                        ‚úì Login
                    </button>
                    <p class="hint">Default: admin123</p>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <main id="mainDashboard" class="main-dashboard" style="display: none;">
            
            <!-- Statistics Cards -->
            <section class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üîë</div>
                    <div class="stat-content">
                        <div class="stat-label">Active Tokens</div>
                        <div class="stat-value" id="activeTokensCount">0</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üì°</div>
                    <div class="stat-content">
                        <div class="stat-label">Connected APIs</div>
                        <div class="stat-value" id="connectedApisCount">0</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <div class="stat-label">Health Status</div>
                        <div class="stat-value" id="healthStatus">--</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-content">
                        <div class="stat-label">Last Updated</div>
                        <div class="stat-value" id="lastUpdated">--:--</div>
                    </div>
                </div>
            </section>

            <!-- Navigation Tabs -->
            <section class="tabs">
                <button type="button" class="tab-button active" data-tab="tokens">
                    <span class="tab-icon">üîë</span>
                    Tokens
                </button>
                <button type="button" class="tab-button" data-tab="apis">
                    <span class="tab-icon">üì°</span>
                    APIs
                </button>
                <button type="button" class="tab-button" data-tab="tester">
                    <span class="tab-icon">üß™</span>
                    API Tester
                </button>
                <button type="button" class="tab-button" data-tab="settings">
                    <span class="tab-icon">‚öôÔ∏è</span>
                    Settings
                </button>
            </section>

            <!-- Tab: Tokens Management -->
            <div id="tokensTab" class="tab-content active">
                <div class="section-header">
                    <h2>üîê Token Management</h2>
                    <button type="button" class="btn btn-success" onclick="showTokenForm()">
                        <span>+</span> New Token
                    </button>
                </div>

                <div id="tokensList" class="tokens-list">
                    <div class="empty-state">
                        <p>No tokens configured yet</p>
                        <button type="button" class="btn btn-primary" onclick="showTokenForm()">Create First Token</button>
                    </div>
                </div>

                <!-- Token Form Modal -->
                <div id="tokenFormModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Create New Token</h3>
                            <button type="button" class="modal-close" onclick="closeTokenForm()">&times;</button>
                        </div>
                        
                        <div id="tokenFormError" class="alert alert-error" style="display: none;"></div>
                        <div id="tokenFormSuccess" class="alert alert-success" style="display: none;"></div>
                        
                        <form class="form-grid" onsubmit="handleCreateToken(event)">
                            <div class="form-group">
                                <label for="tokenName">Token Name</label>
                                <input 
                                    type="text" 
                                    id="tokenName" 
                                    placeholder="e.g., Production API Client"
                                    required
                                />
                            </div>
                            
                            <div class="form-group">
                                <label for="tokenDescription">Description</label>
                                <textarea 
                                    id="tokenDescription" 
                                    placeholder="Optional description"
                                    rows="3"
                                ></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="tokenExpiry">Expiry (days)</label>
                                <input 
                                    type="number" 
                                    id="tokenExpiry" 
                                    placeholder="Leave empty for no expiry"
                                    min="1"
                                />
                            </div>
                            
                            <div class="form-group">
                                <label for="tokenScope">Scope/APIs</label>
                                <select id="tokenScope" multiple>
                                    <option value="cache">Cache API</option>
                                    <option value="health">Health Check</option>
                                    <option value="batch">Batch Operations</option>
                                </select>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeTokenForm()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Create Token</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Token Display Modal -->
                <div id="tokenDisplayModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Token Created Successfully</h3>
                            <button type="button" class="modal-close" onclick="closeTokenDisplay()">&times;</button>
                        </div>
                        
                        <div class="token-display">
                            <div class="alert alert-success">
                                ‚úì Your token has been created and saved
                            </div>
                            
                            <div class="form-group">
                                <label>Your Token</label>
                                <div class="token-value-container">
                                    <input 
                                        type="text" 
                                        id="generatedToken" 
                                        readonly
                                        class="token-input"
                                    />
                                    <button 
                                        type="button"
                                        class="btn btn-small" 
                                        onclick="copyToClipboard('generatedToken')"
                                    >
                                        üìã Copy
                                    </button>
                                </div>
                            </div>
                            
                            <p class="warning">
                                ‚ö†Ô∏è Save this token somewhere safe. You won't be able to see it again!
                            </p>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="closeTokenDisplay()">Done</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: API Endpoints -->
            <div id="apisTab" class="tab-content">
                <div class="section-header">
                    <h2>üì° Connected APIs</h2>
                    <button type="button" class="btn btn-primary" onclick="refreshApiStatus()">
                        üîÑ Refresh Status
                    </button>
                </div>

                <div id="apisList" class="apis-list">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Tab: API Tester -->
            <div id="testerTab" class="tab-content">
                <div class="section-header">
                    <h2>üß™ Postman-like API Tester</h2>
                </div>

                <div class="api-tester-container">
                    <div class="tester-form">
                        <!-- URL Bar (Postman Style) -->
                        <div class="form-group url-bar">
                            <label for="testerMethod">Method</label>
                            <select id="testerMethod" style="width: 100px;">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                                <option value="PATCH">PATCH</option>
                                <option value="HEAD">HEAD</option>
                            </select>
                            
                            <input 
                                type="text" 
                                id="testerUrl" 
                                placeholder="https://cache-api.eternitylabs.co/cache/batch or /cache/batch"
                                style="flex: 1; margin: 0 10px;"
                            />
                            
                            <button type="button" class="btn btn-primary" onclick="sendApiRequest(event)" style="width: auto;">
                                ‚ñ∫ Send
                            </button>
                        </div>

                        <!-- Preset Endpoints -->
                        <div class="form-group">
                            <label>Quick Endpoints:</label>
                            <div class="button-group">
                                <button type="button" class="btn-small" onclick="setEndpoint('GET', '/health', event)">üè• Health</button>
                                <button type="button" class="btn-small" onclick="setEndpoint('POST', '/cache/batch', event)">üì¶ Batch</button>
                                <button type="button" class="btn-small" onclick="setEndpoint('GET', '/cache/stats', event)">üìä Stats</button>
                                <button type="button" class="btn-small" onclick="setEndpoint('GET', '/cache', event)">üìñ Cache</button>
                                <button type="button" class="btn-small" onclick="setEndpoint('DELETE', '/cache/clear', event)">üóëÔ∏è Clear</button>
                                <button type="button" class="btn-small" onclick="setEndpoint('DELETE', '/cache/invalidate', event)">‚ùå Invalidate</button>
                            </div>
                        </div>

                        <!-- Authorization -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div class="form-group">
                                <label for="testerToken">Authorization Token</label>
                                <input 
                                    type="text" 
                                    id="testerToken"
                                    placeholder="eternitylabs123"
                                />
                            </div>
                            <div class="form-group">
                                <label for="testerAuthType">Auth Type</label>
                                <select id="testerAuthType">
                                    <option value="none">-- None --</option>
                                    <option value="bearer" selected>Bearer Token</option>
                                    <option value="basic">Basic Auth</option>
                                    <option value="custom">Custom Header</option>
                                </select>
                            </div>
                        </div>

                        <!-- Tabs for Request -->
                        <div class="request-tabs">
                            <button type="button" class="req-tab-btn active" onclick="switchReqTab('body', event)">üìù Body</button>
                            <button type="button" class="req-tab-btn" onclick="switchReqTab('headers', event)">üè∑Ô∏è Headers</button>
                            <button type="button" class="req-tab-btn" onclick="switchReqTab('params', event)">‚öôÔ∏è Params</button>
                        </div>

                        <!-- Request Body -->
                        <div id="bodyTab" class="req-tab-content">
                            <label for="testerBody">Request Body (JSON)</label>
                            <textarea 
                                id="testerBody" 
                                placeholder='{"team": ["Lakers"], "sport": "Basketball"}'
                                rows="6"
                            ></textarea>
                        </div>

                        <!-- Headers Tab -->
                        <div id="headersTab" class="req-tab-content" style="display: none;">
                            <label for="testerHeaders">Additional Headers (JSON)</label>
                            <textarea 
                                id="testerHeaders" 
                                placeholder='{"Content-Type": "application/json", "X-Custom": "value"}'
                                rows="6"
                            ></textarea>
                        </div>

                        <!-- Params Tab -->
                        <div id="paramsTab" class="req-tab-content" style="display: none;">
                            <label for="testerParams">Query Parameters (JSON)</label>
                            <textarea 
                                id="testerParams" 
                                placeholder='{"key": "value", "filter": "active"}'
                                rows="6"
                            ></textarea>
                        </div>

                        <!-- Send Button -->
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="loadBatchExampleBtn" onclick="loadBatchExample()">üìã Load Batch Example</button>
                            <button type="button" class="btn btn-secondary" onclick="clearTesterForm()">üîÑ Clear</button>
                            <button type="button" class="btn btn-primary" onclick="sendApiRequest(event)" style="flex: 1;">
                                ‚ñ∫ Send Request
                            </button>
                        </div>
                    </div>

                    <!-- Response Display -->
                    <div class="tester-response">
                        <div class="response-header">
                            <h3>Response</h3>
                            <div id="responseStatus" class="response-status" style="display: none;">
                                <span id="statusCode">200</span>
                                <span id="statusText">OK</span>
                            </div>
                        </div>
                        <div id="responseBody" class="response-body">
                            <div style="text-align: center; color: #999; padding: 40px;">
                                Send a request to see the response here
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="settingsTab" class="tab-content">
                <div class="section-header">
                    <h2>‚öôÔ∏è Settings & Configuration</h2>
                </div>

                <div class="settings-form">
                    <div class="setting-group">
                        <h3>Security</h3>
                        <div class="form-group">
                            <label for="changePassword">Change Admin Password</label>
                            <div class="input-group">
                                <input 
                                    type="password" 
                                    id="changePassword" 
                                    placeholder="New password"
                                />
                                <button type="button" class="btn btn-small" onclick="changeAdminPassword()">Update</button>
                            </div>
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>API Configuration</h3>
                        <div class="form-group">
                            <label for="apiEndpoint">API Endpoint</label>
                            <input 
                                type="text" 
                                id="apiEndpoint" 
                                value="https://cache-api.eternitylabs.co"
                                placeholder="https://cache-api.eternitylabs.co"
                            />
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Token Settings</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="autoRefresh" checked />
                                Auto-refresh status (every 30 seconds)
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="showMaskedTokens" checked />
                                Show masked tokens in list
                            </label>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="resetSettings()">Reset to Defaults</button>
                        <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="notifications"></div>

    <script src="js/app.js"></script>
</body>
</html>